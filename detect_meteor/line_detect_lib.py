from logzero import logger
import inner_const


full_area = inner_const.MIDDLE_WIDTH * inner_const.MIDDLE_HEIGHT


def is_line_detected():
    pass

def is_object_too_big(rect_list):
    assert len(rect_list) > 0
    fillRate = get_area_fill_rate_of_multiple_rects(rect_list)
    logger.info("fillRate: %f", fillRate)
    if fillRate > 0.25:
        return True
    else:
        return False



def get_outer_area_of_multiple_rects(rect_list):

    assert len(rect_list) > 0

    min_x = inner_const.MIDDLE_WIDTH-1
    min_y = inner_const.MIDDLE_HEIGHT-1
    max_x = 0
    max_y = 0

    for rect in rect_list:
        x, y, w, h = rect
        if x < min_x:
            min_x = x
        if y < min_y:
            min_y = y
        if x+w > max_x:
            max_x = x+w
        if y+h > max_y:
            max_y = y+h
    area = (max_x - min_x) * (max_y - min_y)
    return area


def get_area_fill_rate_of_multiple_rects(rect_list):
    rect_area = get_outer_area_of_multiple_rects(rect_list)
    ra = rect_area / full_area
    return ra


def test_area_too_big():
    t1 = [
        [100, 110, 5, 5],
        [50, 100, 10, 10],
        [200, 300, 20, 20]
    ]
    assert False == is_object_too_big(t1)
    t2 = [
        [10, 20, 400, 400]
    ]
    assert True == is_object_too_big(t2)
    t3 = [
        [10, 10, 20, 20]
    ]
    assert False == is_object_too_big(t3)
    t4 = [
        [10, 10, 270, 270]
    ]
    assert True == is_object_too_big(t4)
    t5 = [
        [10, 10, 500, 500]
    ]
    assert True == is_object_too_big(t5)







def test_get_area():

    a = get_outer_area_of_multiple_rects([
        [100, 110, 5, 5],
        [50, 100, 10, 10],
        [200, 300, 20, 20]
    ])
    a1 = (220-50) * (320 - 100)
    assert a1 == a


    b = get_outer_area_of_multiple_rects([
        [60, 100, 40, 20]
    ])
    assert b == 40*20





def test_1():
    rects = [{'index': 6, 'rects': [[180, 507, 10, 5], [148, 496, 5, 5], [172, 492, 12, 11], [212, 491, 4, 6], [217, 490, 5, 7], [233, 487, 3, 5], [151, 480, 7, 9], [248, 479, 7, 9], [255, 472, 5, 7], [133, 465, 5, 4], [158, 463, 8, 7], [163, 456, 10, 6], [215, 450, 4, 5], [180, 450, 7, 6], [198, 449, 11, 7], [147, 447, 14, 11], [223, 441, 4, 6], [207, 440, 4, 4], [163, 440, 10, 14], [215, 436, 4, 6], [142, 433, 6, 5], [238, 424, 4, 5], [182, 423, 12, 7], [206, 421, 14, 8], [167, 419, 13, 20], [236, 417, 7, 6], [202, 416, 3, 5], [215, 392, 7, 3], [258, 348, 13, 15], [210, 336, 196, 176]]}, {'index': 7, 'rects': [[180, 507, 10, 5], [169, 501, 4, 6], [173, 496, 11, 8], [212, 489, 11, 8], [168, 477, 4, 4], [150, 475, 8, 13], [133, 465, 5, 4], [159, 463, 7, 7], [166, 455, 7, 7], [257, 452, 5, 3], [164, 451, 4, 3], [215, 450, 4, 5], [195, 448, 8, 8], [147, 448, 13, 9], [138, 446, 7, 5], [196, 442, 7, 5], [158, 438, 15, 11], [215, 436, 3, 5], [189, 436, 4, 6], [265, 435, 3, 4], [142, 433, 6, 5], [177, 432, 4, 5], [237, 424, 6, 8], [206, 421, 10, 5], [182, 421, 5, 9], [167, 420, 13, 13], [236, 417, 6, 6], [202, 417, 3, 4], [211, 353, 191, 159], [258, 349, 8, 14]]}, {'index': 8, 'rects': [[150, 368, 4, 4], [102, 364, 5, 4], [132, 363, 4, 8], [131, 353, 6, 7], [246, 252, 13, 10], [290, 250, 4, 4], [261, 244, 13, 10], [261, 232, 9, 7], [279, 223, 6, 4], [264, 216, 9, 14], [285, 215, 4, 4], [272, 213, 5, 11], [295, 212, 7, 13], [400, 206, 3, 5], [267, 198, 4, 6], [347, 173, 4, 6], [328, 167, 7, 7], [369, 166, 6, 7], [352, 166, 8, 11], [359, 158, 4, 7], [285, 158, 25, 56], [405, 156, 4, 5], [40, 148, 397, 364], [409, 145, 5, 5], [307, 144, 4, 8], [347, 121, 5, 5]]}, {'index': 9, 'rects': [[47, 427, 9, 6], [144, 205, 9, 7], [124, 197, 3, 5], [158, 196, 4, 6], [150, 189, 9, 12], [162, 185, 5, 7], [129, 185, 18, 16], [142, 178, 4, 5], [201, 175, 4, 5], [131, 164, 4, 6], [431, 160, 8, 11], [259, 136, 6, 12], [137, 123, 33, 53], [164, 117, 6, 10], [384, 114, 5, 5], [445, 104, 8, 6], [218, 100, 4, 8], [306, 97, 6, 9], [159, 95, 66, 91], [328, 91, 13, 15], [188, 91, 8, 6], [439, 88, 6, 5], [196, 87, 5, 4], [24, 86, 426, 426], [260, 85, 6, 7], [446, 83, 9, 6], [376, 83, 6, 6], [329, 80, 10, 9], [439, 77, 3, 8], [266, 76, 7, 10], [239, 75, 5, 8], [222, 74, 43, 66], [379, 73, 5, 7], [364, 69, 12, 18], [252, 69, 5, 4], [375, 60, 4, 5], [264, 59, 10, 7], [249, 58, 6, 7], [244, 57, 4, 7], [331, 56, 5, 10], [260, 49, 9, 9], [268, 43, 4, 7], [393, 39, 4, 3], [363, 31, 5, 4], [294, 17, 22, 15]]}, {'index': 10, 'rects': [[199, 242, 6, 6], [197, 236, 3, 4], [145, 205, 7, 7], [157, 196, 6, 7], [151, 189, 6, 11], [123, 188, 22, 16], [161, 185, 6, 7], [135, 182, 5, 4], [199, 174, 6, 6], [206, 171, 5, 4], [131, 164, 3, 5], [137, 161, 12, 23], [247, 116, 8, 13], [383, 114, 5, 5], [172, 111, 3, 6], [216, 101, 7, 7], [420, 98, 4, 4], [305, 97, 6, 9], [214, 94, 5, 6], [137, 91, 87, 96], [390, 90, 4, 7], [188, 90, 4, 6], [421, 86, 4, 4], [196, 86, 5, 6], [446, 83, 9, 6], [436, 81, 6, 4], [327, 80, 15, 28], [343, 78, 3, 6], [232, 77, 3, 4], [428, 75, 4, 5], [390, 75, 5, 7], [326, 74, 5, 4], [266, 73, 7, 10], [278, 70, 7, 5], [220, 69, 46, 71], [25, 68, 427, 444], [347, 63, 4, 4], [195, 63, 4, 5], [278, 59, 5, 7], [264, 58, 13, 8], [387, 55, 4, 5], [250, 54, 11, 13], [282, 53, 5, 4], [272, 51, 8, 6], [260, 49, 6, 6], [355, 47, 3, 5], [340, 47, 3, 6], [332, 47, 6, 17], [287, 45, 5, 11], [268, 43, 7, 8], [391, 36, 6, 6], [300, 35, 7, 12], [280, 33, 4, 6], [363, 30, 7, 6], [279, 20, 7, 9], [292, 19, 18, 13], [308, 16, 9, 14]]}, {'index': 11, 'rects': [[103, 301, 5, 7], [91, 265, 4, 4], [77, 250, 4, 5], [69, 215, 6, 8], [61, 204, 7, 5], [64, 182, 3, 7], [69, 159, 10, 18], [80, 125, 4, 4], [84, 120, 10, 8], [225, 42, 3, 5], [477, 37, 3, 7], [507, 29, 5, 9], [437, 23, 5, 7], [447, 9, 4, 4], [478, 5, 6, 5], [335, 2, 4, 9], [225, 0, 5, 4]]}, {'index': 12, 'rects': [[103, 302, 5, 6], [91, 265, 4, 4], [77, 250, 4, 5], [69, 215, 6, 8], [61, 202, 8, 7], [64, 182, 3, 7], [69, 160, 10, 17], [79, 124, 6, 5], [85, 120, 9, 8], [471, 45, 4, 4], [225, 42, 3, 6], [477, 37, 3, 7], [507, 29, 5, 9], [437, 23, 5, 7], [445, 9, 6, 5], [478, 5, 6, 5], [336, 2, 3, 9], [225, 0, 5, 4]]}, {'index': 13, 'rects': [[6, 387, 6, 5], [22, 369, 5, 7], [27, 360, 5, 7], [20, 352, 7, 15], [33, 338, 5, 6], [31, 323, 5, 3], [36, 311, 8, 8], [69, 298, 6, 5], [54, 291, 4, 5], [70, 287, 5, 5], [59, 287, 10, 16], [193, 0, 8, 10]]}, {'index': 14, 'rects': [[6, 384, 3, 6], [22, 362, 5, 14], [27, 360, 4, 5], [20, 352, 7, 8], [32, 337, 6, 7], [30, 323, 6, 4], [37, 311, 7, 8], [69, 298, 4, 5], [54, 291, 3, 5], [70, 287, 5, 6], [59, 287, 10, 16], [63, 281, 4, 8], [128, 54, 3, 4], [189, 0, 12, 10]]}, {'index': 15, 'rects': [[31, 199, 5, 8], [33, 179, 6, 8], [81, 56, 6, 7], [98, 39, 4, 4], [122, 6, 8, 4], [99, 3, 5, 5], [117, 0, 5, 6]]}, {'index': 16, 'rects': [[31, 243, 5, 11], [33, 211, 7, 7], [30, 202, 5, 9], [61, 89, 9, 9], [82, 67, 4, 5], [85, 57, 6, 6], [86, 31, 7, 8], [107, 4, 4, 10], [95, 4, 7, 5]]}, {'index': 17, 'rects': [[31, 243, 5, 11], [33, 211, 7, 7], [30, 202, 5, 9], [61, 89, 9, 9], [82, 67, 4, 5], [85, 57, 6, 6], [86, 31, 7, 8], [107, 4, 4, 10], [95, 4, 7, 5]]}, {'index': 18, 'rects': [[30, 237, 4, 4], [38, 142, 4, 5], [63, 87, 7, 10], [71, 79, 5, 6], [58, 50, 6, 3], [86, 30, 9, 11], [101, 18, 4, 6], [98, 2, 15, 12], [109, 0, 6, 6]]}, {'index': 19, 'rects': [[30, 237, 4, 4], [38, 142, 4, 5], [63, 87, 7, 10], [71, 79, 5, 6], [58, 50, 6, 3], [86, 30, 9, 11], [101, 18, 4, 6], [98, 2, 15, 12], [109, 0, 6, 6]]}, {'index': 20, 'rects': [[8, 302, 5, 5], [21, 263, 6, 10], [64, 87, 7, 8], [72, 80, 4, 3], [73, 69, 4, 6], [80, 64, 8, 4], [61, 47, 6, 7], [85, 36, 6, 5], [71, 34, 6, 6], [127, 26, 4, 3], [101, 18, 4, 9], [76, 8, 5, 5]]}, {'index': 21, 'rects': [[8, 302, 5, 5], [21, 263, 6, 10], [64, 87, 7, 8], [72, 80, 4, 3], [73, 69, 4, 6], [80, 64, 8, 4], [61, 47, 6, 7], [85, 36, 6, 5], [71, 34, 6, 6], [127, 26, 4, 3], [101, 18, 4, 9], [76, 8, 5, 5]]}, {'index': 22, 'rects': [[14, 278, 4, 5], [26, 205, 9, 7], [48, 98, 10, 7], [61, 49, 8, 7], [94, 30, 6, 7], [84, 29, 8, 21], [93, 23, 5, 5], [79, 8, 4, 6], [115, 0, 6, 4], [90, 0, 9, 5]]}, {'index': 23, 'rects': [[14, 278, 3, 4], [25, 203, 12, 9], [79, 61, 7, 6], [85, 30, 7, 7], [93, 23, 5, 5], [94, 19, 14, 18], [101, 5, 5, 5], [126, 0, 7, 7], [90, 0, 9, 5]]}, {'index': 24, 'rects': [[20, 271, 5, 3], [17, 264, 4, 5], [72, 68, 6, 6], [77, 30, 3, 8], [87, 20, 7, 5], [92, 9, 3, 4]]}, {'index': 25, 'rects': [[6, 294, 5, 3], [52, 95, 6, 6], [67, 45, 3, 6], [55, 45, 9, 8], [81, 35, 11, 11], [86, 20, 8, 6], [92, 0, 6, 5], [74, 0, 7, 5]]}, {'index': 26, 'rects': [[6, 294, 5, 3], [52, 95, 6, 6], [67, 45, 3, 6], [55, 45, 9, 8], [81, 35, 11, 11], [86, 20, 8, 6], [92, 0, 6, 5], [74, 0, 7, 5]]}, {'index': 27, 'rects': [[4, 296, 3, 5], [48, 99, 4, 4], [53, 98, 6, 8], [70, 67, 6, 12], [68, 46, 4, 7], [70, 37, 5, 5], [89, 14, 7, 4], [104, 11, 7, 7], [94, 9, 4, 3], [73, 7, 6, 8], [112, 0, 4, 6], [100, 0, 12, 9], [93, 0, 5, 4]]}, {'index': 28, 'rects': [[4, 296, 3, 5], [49, 106, 3, 7], [48, 99, 4, 4], [53, 98, 6, 8], [70, 67, 6, 12], [68, 46, 4, 7], [80, 43, 3, 5], [70, 37, 5, 5], [89, 14, 7, 4], [104, 11, 7, 7], [94, 9, 4, 3], [73, 7, 6, 8], [112, 0, 4, 6], [100, 0, 12, 9], [93, 0, 5, 4]]}, {'index': 29, 'rects': [[20, 198, 4, 6], [30, 157, 4, 6], [57, 67, 4, 7], [69, 28, 12, 14], [63, 23, 5, 4], [95, 10, 5, 4]]}]


